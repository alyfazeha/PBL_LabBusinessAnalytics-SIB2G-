<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dosen | Lab Business Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../frontend/assets/css/dashboarddns.css">
    <link rel="stylesheet" href="../assets/css/cssadmin.css">
    <link rel="stylesheet" href="../../assets/css/cssmahasiswa.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f7fe;
        }

        /* --- IMPROVED STATS GRID --- */
        .stats-grid-dosen {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card-new {
            padding: 30px 25px;
            border-radius: 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            border: none;
        }

        .stat-card-new:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.12);
            filter: brightness(1.05);
        }

        .stat-card-new::after {
            content: '';
            position: absolute;
            right: -20px;
            top: -20px;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .stat-card-new.blue {
            background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
        }

        .stat-card-new.green {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .stat-card-new.orange {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .stat-card-new .info h2 {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
            line-height: 1.2;
        }

        .stat-card-new .info p {
            font-size: 0.95rem;
            font-weight: 500;
            margin: 5px 0 0;
            opacity: 0.9;
        }

        .stat-card-new i {
            font-size: 3.5rem;
            opacity: 0.25;
            transition: all 0.3s ease;
        }

        .stat-card-new:hover i {
            opacity: 0.4;
            transform: scale(1.1) rotate(-10deg);
        }

        /* --- TABLE STYLE (ADMIN MATCH) --- */
        .recent-section {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.04);
        }

        .table-wrapper {
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #edf2f7;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table thead th {
            background-color: #4A90E2;
            color: #ffffff;
            text-transform: uppercase;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.8px;
            padding: 18px 15px;
            text-align: left;
        }

        .data-table tbody td {
            padding: 16px 15px;
            font-size: 13px;
            color: #4a5568;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background-color: #f8fbff;
        }

        /* Badge Status */
        .status {
            padding: 6px 14px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: 700;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status.APPROVED,
        .status.DISETUJUI {
            background: #e6fffa;
            color: #047481;
            border: 1px solid #b2f5ea;
        }

        .status.PENDING,
        .status.MENUNGGU {
            background: #fffaf0;
            color: #9c4221;
            border: 1px solid #feebc8;
        }

        .status.REJECTED,
        .status.DITOLAK {
            background: #fff5f5;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .btn-edit-action {
            background-color: #f0f7ff;
            color: #4A90E2;
            padding: 8px 15px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .btn-edit-action:hover {
            background-color: #4A90E2;
            color: white;
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <div id="toastNotificationContainer"></div>

    <aside class="sidebar">
        <div class="logo-area">
            <img src="../assets/images/LogoPolinema.png" alt="" style="width: 50px;">
            <img src="../assets/images/logoJTI.png" alt="" style="width: 45px;">
            <img src="../assets/images/LogoLab2.png" alt="Logo"
                style="width: 70px; margin-bottom: -10px; margin-left: -10px;">
            <h3>Dashboard Dosen</h3>
        </div>
        <nav>
            <a href="index.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="../public/index.html"
                style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 10px; padding-top: 15px;">
                <i class="fas fa-external-link-alt"></i> Lihat Landing Page
            </a>
            <a href="profile.html"><i class="fas fa-user-tie"></i> Profil & Akun</a>
            <a href="riwayat_peminjaman.html"><i class="fas fa-book-reader"></i> Riwayat Peminjaman</a>
            <a href="publikasi.html"><i class="fas fa-file-invoice"></i> Kelola Publikasi</a>
            <a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </aside>

    <main class="main-content">
        <header style="margin-bottom: 35px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px;">
            <h1 style="font-size: 1.8rem; color: #2d3748; margin: 0; font-weight: 700;">Halo, <span id="welcomeMessage"
                    style="color: #4A90E2;">Dosen</span>! ðŸ‘‹</h1>
        </header>

        <div class="stats-grid-dosen">
            <a href="publikasi.html" class="stat-card-new blue">
                <div class="info">
                    <h2 id="totalPublications">0</h2>
                    <p>Total Publikasi</p>
                </div>
                <i class="fas fa-file-alt"></i>
            </a>
            <a href="riwayat_peminjaman.html" class="stat-card-new green">
                <div class="info">
                    <h2 id="totalLoans">0</h2>
                    <p>Riwayat Peminjaman</p>
                </div>
                <i class="fas fa-clipboard-list"></i>
            </a>
            <a href="publikasi.html" class="stat-card-new orange">
                <div class="info">
                    <h2 id="pendingPublications">0</h2>
                    <p>Perlu Validasi</p>
                </div>
                <i class="fas fa-clock"></i>
            </a>
        </div>

        <div class="recent-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3 style="margin: 0; color: #2d3748; font-size: 1.2rem; font-weight: 700;">
                    <i class="fas fa-feather-alt" style="color: #4A90E2; margin-right: 10px;"></i> Publikasi Terkini
                </h3>
                <a href="publikasi.html"
                    style="font-size: 0.85rem; color: #4A90E2; font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 5px;">
                    Kelola Semua <i class="fas fa-chevron-right" style="font-size: 10px;"></i>
                </a>
            </div>

            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th style="width: 70px;">ID</th>
                            <th>Judul Jurnal</th>
                            <th style="width: 80px;">Tahun</th>
                            <th>Kategori</th>
                            <th>Fokus Riset</th>
                            <th style="text-align: center;">Status</th>
                            <th style="text-align: center;">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="latestPublicationsList">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 50px; color: #a0aec0;">
                                <i class="fas fa-circle-notch fa-spin fa-2x"></i>
                                <p style="margin-top: 10px;">Menyelaraskan data...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="logoutModal" class="modal logout-modal">
        <div class="modal-content">
            <span class="close-btn"
                onclick="document.getElementById('logoutModal').style.display='none';">&times;</span>
            <h4><i class="fas fa-sign-out-alt"></i> Konfirmasi Logout</h4>
            <p>Anda yakin ingin keluar dari sistem?</p>
            <div class="modal-buttons">
                <button onclick="document.getElementById('logoutModal').style.display='none';"
                    class="btn btn-secondary">Batal</button>
                <button id="confirmLogoutBtn" class="btn btn-danger">Ya, Logout</button>
            </div>
        </div>
    </div>

    <script>
        const API_DASHBOARD = '../../backend/api/dosen/get_dashboard_summary.php';

        async function loadDashboardData() {
            localStorage.setItem('dosen_status', 'active');
            try {
                const response = await fetch(API_DASHBOARD);
                const result = await response.json();

                if (result.status === 'success') {
                    const data = result.data;
                    document.getElementById('welcomeMessage').textContent = data.nama || 'Dosen';
                    document.getElementById('totalPublications').textContent = data.total_publikasi || 0;
                    document.getElementById('totalLoans').textContent = data.total_peminjaman || 0;
                    document.getElementById('pendingPublications').textContent = data.publikasi_pending || 0;

                    const listContainer = document.getElementById('latestPublicationsList');
                    listContainer.innerHTML = '';

                    if (data.latest_publications && data.latest_publications.length > 0) {
                        data.latest_publications.forEach(pub => {
                            const statusUpper = (pub.status || 'PENDING').toUpperCase();

                            listContainer.innerHTML += `
                                <tr class="data-row">
                                    <td style="font-weight: 700; color: #4A90E2;">#${pub.id}</td>
                                    <td style="font-weight: 600; color: #2d3748; max-width: 250px;">${pub.judul}</td>
                                    <td style="font-weight: 500;">${pub.tahun || '-'}</td>
                                    <td>
                                        <span style="background: #ebf8ff; color: #2c5282; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; border: 1px solid #bee3f8;">
                                            ${pub.nama_kategori || pub.kategori || '-'}
                                        </span>
                                    </td>
                                    <td style="color: #718096; font-size: 12px; line-height: 1.4;">
                                        ${pub.fokus_riset || '-'}
                                    </td>
                                    <td style="text-align: center;">
                                        <span class="status ${statusUpper}">${statusUpper}</span>
                                    </td>
                                    <td style="text-align: center;">
                                        <a href="edit_publikasi.html?id=${pub.id}" class="btn-edit-action">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                    </td>
                                </tr>
                            `;
                        });
                    } else {
                        listContainer.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #a0aec0; padding: 40px;">Belum ada riwayat publikasi tercatat.</td></tr>';
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('latestPublicationsList').innerHTML = '<tr><td colspan="7" style="text-align: center; color: #e53e3e; padding: 40px;">Gagal memuat data dari server. Silakan muat ulang halaman.</td></tr>';
            }
        }

        // Logic Logout
        const logoutModal = document.getElementById('logoutModal');
        document.getElementById('logoutLink').onclick = (e) => {
            e.preventDefault();
            logoutModal.style.display = 'flex';
        };

        document.getElementById('confirmLogoutBtn').onclick = async () => {
            try {
                await fetch('../../backend/api/auth/logout.php', { method: 'POST' });

                // Tambahkan baris ini untuk menghapus session browser
                localStorage.removeItem('dosen_status');

                window.location.href = '../public/index.html';
            } catch (error) {
                console.error("Logout gagal", error);
            }
        };

        document.addEventListener('DOMContentLoaded', loadDashboardData);
    </script>
</body>

</html>
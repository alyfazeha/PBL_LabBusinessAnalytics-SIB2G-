<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Dosen</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../../frontend/assets/css/dashboarddns.css">
    <link rel="stylesheet" href="../assets/css/cssadmin.css">
</head>

<body>
    <aside class="sidebar">
        <div class="logo-area">
            <img src="../assets/images/LogoPolinema.png" alt="" style="width: 50px;">
            <img src="../assets/images/logoJTI.png" alt="" style="width: 45px;">
            <img src="../assets/images/LogoLab2.png" alt="Business Analytics Laboratory"
                style="width: 70px; margin-bottom: -10px; margin-left: -10px;">
            <h3>Dashboard Dosen</h3>
        </div>
        <nav>
            <a href="index.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a href="../public/index.html"
                style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 10px; padding-top: 15px;">
                <i class="fas fa-external-link-alt"></i> Lihat Landing Page
            </a>
            <a href="profile.html"><i class="fas fa-user-tie"></i> Profil & Akun</a>
            <a href="riwayat_peminjaman.html"><i class="fas fa-book-reader"></i> Riwayat Peminjaman</a>
            <a href="publikasi.html"><i class="fas fa-file-invoice"></i> Kelola Publikasi</a>

            <a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </aside>

    <main class="main-content">
        <header style="margin-bottom: 35px; border-bottom: 1px solid #e2e8f0; padding-bottom: 15px;">
            <h1 style="font-size: 1.8rem; color: #2d3748; margin: 0;">Selamat Datang, <span id="welcomeMessage"
                    style="color: var(--primary-blue);">Dosen</span>! ðŸ‘‹</h1>
            <p style="color: #718096; margin-top: 5px;">Kelola publikasi dan pantau peminjaman bapak/ibu di sini.</p>
        </header>


        <div class="status-grid">
            <div class="status-card approved">
                <div class="status-info">
                    <h3>Total Publikasi</h3>
                    <p id="totalPublications">...</p>
                </div>
                <div class="status-icon"><i class="fas fa-scroll"></i></div>
            </div>

            <div class="status-card info" style="border-left: 5px solid #007bff;">
                <div class="status-info">
                    <h3>Total Peminjaman</h3>
                    <p id="totalLoans">...</p>
                </div>
                <div class="status-icon"><i class="fas fa-book-reader"></i></div>
            </div>

            <div class="status-card pending">
                <div class="status-info">
                    <h3>Publikasi Pending</h3>
                    <p id="pendingPublications">...</p>
                </div>
                <div class="status-icon"><i class="fas fa-hourglass-half"></i></div>
            </div>
        </div>

        <div class="content-card">
            <h2><i class="fas fa-file-alt"></i> Publikasi Terbaru Anda</h2>
            <div id="latestPublicationsList">
                <div class="pub-item">
                    <div class="pub-info">
                        <h3>Memuat data...</h3>
                        <p>...</p>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <a href="publikasi.html"
                    style="color: var(--primary-blue); text-decoration: none; font-weight: 600;">Lihat Semua Publikasi
                    <i class="fas fa-arrow-right"></i></a>
            </div>
        </div>
    </main>

    <script>
        // --- API Endpoints ---
        const API_DASHBOARD = '../../backend/api/dosen/get_dashboard_summary.php';
        const API_LOGOUT = '../../backend/api/auth/logout.php';

        async function loadDashboardData() {
            try {
                const response = await fetch(API_DASHBOARD);
                const text = await response.text();
                const result = JSON.parse(text);

                if (result.status === 'success') {
                    const data = result.data;

                    const namaDosen = data.nama || 'Dosen';
                    document.getElementById('welcomeMessage').textContent = ` ${namaDosen}`;

                    // Mengisi Status Kartu
                    document.getElementById('totalPublications').textContent = data.total_publikasi || 0;
                    document.getElementById('totalLoans').textContent = data.total_peminjaman || 0;
                    document.getElementById('pendingPublications').textContent = data.publikasi_pending || 0;

                    const listContainer = document.getElementById('latestPublicationsList');
                    listContainer.innerHTML = '';

                    if (data.latest_publications && data.latest_publications.length > 0) {
                        data.latest_publications.forEach(pub => {
                            const pubItem = document.createElement('div');
                            pubItem.className = 'pub-item';

                            let statusClass = pub.status.toLowerCase().replace(' ', '');

                            pubItem.innerHTML = `
                                <div class="pub-info">
                                    <h3>Judul: ${pub.judul}</h3>
                                    <p>Jenis: ${pub.jenis} | Tanggal: ${pub.tanggal} | Status: <span class="badge ${statusClass}">${pub.status}</span></p>
                                </div>
                                <div class="pub-actions">
                                    <a href="edit_publikasi.html?id=${pub.id}" class="btn-edit"><i class="fas fa-edit"></i> Edit</a>
                                </div>
                            `;
                            listContainer.appendChild(pubItem);
                        });
                    } else {
                        listContainer.innerHTML = '<p style="text-align: center;">Belum ada publikasi yang diajukan.</p>';
                    }

                } else {
                    alert(result.message || 'Sesi Anda telah berakhir. Silakan login kembali.');
                    window.location.href = '../public/login.html';
                }

            } catch (error) {
                console.error('Error memuat data dashboard:', error);
                document.getElementById('welcomeMessage').textContent = 'Selamat Datang (Gagal Memuat Data)!';
            }
        }

        document.addEventListener('DOMContentLoaded', loadDashboardData);

        // Logika Logout (tetap sama)
        document.getElementById('logoutLink').addEventListener('click', function (e) {
            e.preventDefault();
            if (confirm('Apakah Anda yakin ingin keluar dari sistem?')) {
                fetch(API_LOGOUT, { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        window.location.href = '../public/index.html';
                    })
                    .catch(error => {
                        alert('Terjadi kesalahan saat logout.');
                        window.location.href = '../public/index.html';
                    });
            }
        });
    </script>
</body>

</html>
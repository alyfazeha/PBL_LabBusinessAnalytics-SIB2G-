<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Daftar lengkap berita dan pengumuman dari Business Analytics Laboratory.">
    <meta name="author" content="Business Analytics Laboratory">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
        rel="stylesheet">

    <title>Daftar Berita | Business Analytics Laboratory</title>

    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/css/templatemo-chain-app-dev.css">
    <link rel="stylesheet" href="../assets/css/animated.css">
    <link rel="stylesheet" href="../assets/css/owl.css">

    <link rel="stylesheet" href="../assets/css/beritacss.css">

</head>

<body>
    <header class="header-area header-sticky wow slideInDown" data-wow-duration="0.75s" data-wow-delay="0s">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <a href="index.html" class="logo" style="margin-top: -7px;">
                            <img src="../assets/images/LogoPolinema.png" alt="" style="width: 60px;">
                            <img src="../assets/images/logoJTI.png" alt="" style="width: 50px;">
                            <img src="../assets/images/LogoLab2.png" alt="Business Analytics Laboratory"
                                style="width: 90px; margin-left: -15px;">
                        </a>
                        <ul class="nav">
                            <li class="scroll-to-section"><a href="index.html">Beranda</a></li>
                            <li class="scroll-to-section"><a href="index.html">Gallery</a></li>
                            <li class="scroll-to-section"><a href="berita.html" class="active">Berita</a></li>
                            <li class="scroll-to-section"><a href="jadwal-lab.html">Jadwal</a></li>
                            <li class="scroll-to-section"><a href="panduan_peminjaman.html">Peminjaman</a></li>
                            <li>
                                <div class="gradient-button"><a id="" href="login.html"><i
                                            class="fa fa-sign-in-alt"></i>
                                        Register | Login</a></div>
                            </li>
                        </ul>
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </header>
    <div class="page-heading header-text" id="top">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <span class="breadcrumb-item"><a href="index.html">Beranda</a> / Berita</span>
                    <h4>Daftar Berita & Pengumuman</h4>
                </div>
            </div>
        </div>
    </div>

    <div id="berita-list-section" class="section">
        <div class="container">
            <div class="row">

                <div class="col-lg-12" style="margin-top: -50px;">
                    <div class="berita-filter-tabs">
                        <button class="filter-btn active" data-category="Semua">Semua</button>
                        <button class="filter-btn" data-category="Agenda">Agenda</button>
                        <button class="filter-btn" data-category="Berita">Berita</button>
                        <button class="filter-btn" data-category="Pengumuman">Pengumuman</button>
                        <button class="filter-btn" data-category="Prestasi">Prestasi</button>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="row grid-berita" id="beritaContainer">
                        <div class="col-lg-12" id="beritaLoading">
                            <p class="text-center w-100 loading-message">Memuat data berita, mohon tunggu...</p>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="pagination" id="beritaPagination">
                    </div>
                </div>

            </div>
        </div>
    </div>
    <footer id="newsletter">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 offset-lg-2">
                    <div class="section-heading" style="margin-top: -30px;">
                        <h4>Get to Know Us</h4>
                    </div>
                </div>
                <div class="col-lg-6 offset-lg-3">
                    <form id="search" action="#" method="GET">
                        <div class="row" style="margin-top: -30px; margin-bottom: -50px;">
                            <fieldset>
                                <button class="main-button"><a href="https://www.polinema.ac.id" style="color: #fff; "
                                        target="_blank">Politeknik Negeri
                                        Malang Official
                                        Website</a></button>
                            </fieldset>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col" style="padding-right: 50px;">
                    <div class="footer-widget">
                        <h4>Tentang Lab Kami</h4>
                        <div class="img">
                            <img src="../assets/images/LogoPolinema.png" alt="Logo Polinema" style="width: 80px;">
                            <img src="../assets/images/logoJTI.png" alt="Logo JTI" style="width: 70px;">
                            <img src="../assets/images/LogoLab2.png" alt="Logo Lab"
                                style="width: 110px; margin-left: -14px;">
                        </div>
                        <p>Laboratorium Jurusan Teknologi Informasi yang berfokus pada riset dan solusi
                            teknologi
                            informasi untuk
                            mendukung dunia
                            bisnis dan akademis.</p>
                    </div>
                </div>
                <div class="col">
                    <div class="footer-widget">
                        <h4>Hubungi Kami</h4>
                        <p>Jl. Soekarno Hatta No.9, Jatimulyo, Kec. Lowokwaru, Kota Malang, Jawa Timur 65141</p>

                        <div class="social-links-footer">
                            <a href="https://www.instagram.com/jtipolinema/" target="_blank"
                                title="Kunjungi Instagram Lab">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="https://www.youtube.com/@jtipolinema367" target="_blank"
                                title="Tonton Video di YouTube Lab">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="col">
                    <div class="footer-widget">
                        <div class="map-container" style="margin-bottom: 20px; position: relative;">

                            <a href="https://maps.google.com/?cid=8691078281011477154&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ"
                                target="_blank"
                                style="display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10;"
                                title="Buka Google Maps Politeknik Negeri Malang">
                            </a>

                            <iframe
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3951.5026830854117!2d112.6161209!3d-7.946891200000002!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e78827687d272e7%3A0x789ce9a636cd3aa2!2sPoliteknik%20Negeri%20Malang!5e0!3m2!1sid!2sid!4v1765378894293!5m2!1sid!2sid"
                                width="100%" height="250"
                                style="border:0; border-radius: 8px; position: relative; z-index: 1;" allowfullscreen=""
                                loading="lazy" referrerpolicy="no-referrer-when-downgrade"
                                title="Peta Lokasi Politeknik Negeri Malang">
                            </iframe>
                        </div>
                    </div>
                </div>

                <div class="col-lg-12" style="margin-top: -50px; margin-bottom: -50px;">
                    <div class="copyright-text">
                        <p>Copyright Â© 2025 Business Analytics Laboratory. All Rights Reserved.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/owl-carousel.js"></script>
    <script src="../assets/js/animation.js"></script>
    <script src="../assets/js/imagesloaded.js"></script>
    <script src="../assets/js/templatemo-custom.js"></script>
    <script src="../assets/js/popup.js"></script>

    <script>
        // --- 1. Variabel Global ---
        let allBeritaData = [];
        const API_URL = '../../backend/api/contents/list_public.php';

        // --- Variabel Pagination Baru ---
        let currentPage = 1;
        const itemsPerPage = 6; // Hanya tampilkan 6 berita per halaman
        let currentCategory = 'Semua'; // Menyimpan kategori yang sedang aktif
        // -----------------------------------------------------------------------

        function getCorrectImagePath(path) {
            if (!path) return '../assets/images/placeholder-berita.jpg';
            if (path.startsWith('http')) return path; // Jika link luar
            if (path.startsWith('../../')) return path.replace('../../', '../'); // Koreksi path lokal
            return path;
        }

        // --- 2. Fungsi untuk membuat kerangka Kartu Berita ---
        function createBeritaCard(data) {
            // Gunakan slug jika ada, jika tidak gunakan ID
            const identifier = data.slug || data.id;
            const detailUrl = `detail_berita.html?slug=${identifier}`;
            const imageUrl = getCorrectImagePath(data.featured_image);
            const kategoriNama = data.category_name || 'Umum';
            const tanggal = data.created_at ? new Date(data.created_at).toLocaleDateString('id-ID', {
                year: 'numeric', month: 'long', day: 'numeric'
            }) : '-';

            return `
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="berita-card">
                    <a href="${detailUrl}">
                        <div class="berita-thumb">
                            <img src="${imageUrl}" alt="${data.title || 'Berita'}" onerror="this.src='../assets/images/placeholder-berita.jpg'">
                            <span class="kategori">${kategoriNama}</span>
                        </div>
                    </a>
                    <div class="berita-content">
                        <div class="berita-meta">
                            <span><i class="fa fa-calendar-alt"></i> ${tanggal}</span>
                        </div>
                        <a href="${detailUrl}">
                            <h4 class="text-truncate-2">${data.title}</h4>
                        </a>
                        <p class="text-truncate-3">${data.excerpt || ''}</p>
                        <a href="${detailUrl}" class="read-more">Baca Selengkapnya <i class="fa fa-arrow-right"></i></a>
                    </div>
                </div>
            </div>
        `;
        }



        // --- 3. Fungsi Pembuat Pagination ---
        function renderPagination(totalItems, itemsPerPage, currentPage) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const paginationContainer = document.getElementById('beritaPagination');

            if (!paginationContainer) return; // Cek keamanan

            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }

            let html = '<ul>';

            // Tombol 'Previous'
            const prevPage = currentPage - 1;
            const isPrevDisabled = currentPage === 1;
            html += `<li><a href="#" data-page="${prevPage}" class="${isPrevDisabled ? 'disabled' : ''}"><i class="fa fa-angle-left"></i></a></li>`;

            // Tombol Halaman (1, 2, 3, ...)
            for (let i = 1; i <= totalPages; i++) {
                html += `<li><a href="#" data-page="${i}" class="${i === currentPage ? 'active' : ''}">${i}</a></li>`;
            }

            // Tombol 'Next'
            const nextPage = currentPage + 1;
            const isNextDisabled = currentPage === totalPages;
            html += `<li><a href="#" data-page="${nextPage}" class="${isNextDisabled ? 'disabled' : ''}"><i class="fa fa-angle-right"></i></a></li>`;

            html += '</ul>';
            paginationContainer.innerHTML = html;

            // Tambahkan Event Listener ke Tombol Pagination
            paginationContainer.querySelectorAll('a:not(.disabled)').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const newPage = parseInt(this.getAttribute('data-page'));

                    if (newPage >= 1 && newPage <= totalPages) {
                        currentPage = newPage;
                        // Render ulang dengan halaman baru dan kategori yang sedang aktif
                        filterAndRenderBerita(currentCategory, currentPage);

                        // Scroll ke atas section berita (UX bagus)
                        const section = document.getElementById('berita-list-section');
                        if (section) {
                            window.scrollTo({
                                top: section.offsetTop - 120, // Offset untuk header
                                behavior: 'smooth'
                            });
                        }
                    }
                });
            });
        }


        // --- 4. Fungsi untuk FILTER dan RENDER data + Pagination ---
        function filterAndRenderBerita(category = 'Semua', page = 1) {
            const container = document.getElementById('beritaContainer');
            currentCategory = category; // Update kategori aktif
            currentPage = page; // Update halaman aktif
            let filteredData = allBeritaData;

            // 1. Logika Filtering
            if (category !== 'Semua') {
                filteredData = allBeritaData.filter(berita =>
                    berita.category_name && berita.category_name.toLowerCase() === category.toLowerCase()
                );
            }

            // 2. Logika Pagination (Mengambil 6 data per halaman)
            const totalItems = filteredData.length;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, endIndex);


            // 3. Rendering Konten
            if (paginatedData.length === 0) {
                container.innerHTML = `<div class="col-lg-12"><p class="text-center w-100 loading-message">Tidak ada berita dalam kategori ${category} yang ditemukan.</p></div>`;
                // Hapus pagination jika tidak ada data
                const paginationContainer = document.getElementById('beritaPagination');
                if (paginationContainer) paginationContainer.innerHTML = '';
                return;
            }

            let htmlContent = '';
            paginatedData.forEach(berita => {
                htmlContent += createBeritaCard(berita);
            });

            container.innerHTML = htmlContent;

            // 4. Render Pagination Controls
            renderPagination(totalItems, itemsPerPage, currentPage);

            // Re-initialize WOW (untuk animasi fadeIn)
            if (window.WOW) {
                new WOW().init();
            }
        }


        // --- 5. Fungsi Utama untuk mengambil dan menyimpan data (fetch) ---
        const fetchAndRenderBerita = async () => {
            const container = document.getElementById('beritaContainer');
            let loadingElement = document.getElementById('beritaLoading');

            // Pastikan ada loading message saat fetch
            if (!loadingElement) {
                container.innerHTML = `<div class="col-lg-12" id="beritaLoading"><p class="text-center w-100 loading-message">Mengambil data...</p></div>`;
                loadingElement = document.getElementById('beritaLoading');
            } else {
                loadingElement.innerHTML = '<p class="text-center w-100 loading-message">Mengambil data...</p>';
            }

            try {
                const response = await fetch(API_URL);

                if (!response.ok) {
                    throw new Error(`Gagal mengambil data dari API: Status ${response.status}`);
                }

                const result = await response.json();

                if (result && result.status === 'success' && Array.isArray(result.data)) {
                    // SIMPAN DATA KE VARIABEL GLOBAL
                    allBeritaData = result.data;
                    if (loadingElement) loadingElement.remove();

                    // Panggil Render/Filter dengan kategori 'Semua' dan halaman 1
                    filterAndRenderBerita('Semua', 1);
                    setupFilterListeners();

                } else {
                    throw new Error(result.message || 'API merespon error tanpa detail.');
                }

            } catch (error) {
                console.error('Error fetching Berita data:', error);
                container.innerHTML = `<div class="col-lg-12"><p class="text-center w-100 error-message" style="color: red;">Gagal memuat data berita. Pastikan URL API sudah benar. (${error.message})</p></div>`;
            }
        };

        // --- 6. Fungsi Memasang Event Listeners pada Tombol Filter ---
        function setupFilterListeners() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // Hapus kelas 'active' dari semua tombol
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // Tambahkan kelas 'active' ke tombol yang diklik
                    this.classList.add('active');

                    const category = this.getAttribute('data-category');
                    // Saat ganti kategori, selalu kembali ke Halaman 1
                    filterAndRenderBerita(category, 1);
                });
            });
        }

        // --- 7. Jalankan fungsi saat seluruh halaman selesai dimuat ---
        window.addEventListener('load', fetchAndRenderBerita);
    </script>
</body>

</html>